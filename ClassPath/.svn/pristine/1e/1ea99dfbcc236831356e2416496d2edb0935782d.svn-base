<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>학적 변경 신청 관리 시스템</title>
    <link rel="stylesheet" href="/dist/assets/css/bodyFormat.css">
    <link rel="stylesheet" href="/dist/assets/css/staff/requestCollection.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body>
    <div class="container">
        <h1 class="pageTitle">
            <i class="fas fa-graduation-cap"></i>
            학적 변경 신청 관리 시스템
        </h1>

        <!-- 통계 카드 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">${requestStatus.total }</div>
                <div class="stat-label">전체 신청</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="stat-number">${requestStatus.waiting }</div>
                <div class="stat-label">대기 중</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="stat-number">${requestStatus.rejected }</div>
                <div class="stat-label">반려 처리</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <div class="stat-number">${requestStatus.complete }</div>
                <div class="stat-label">승인 완료</div>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tabContainer">
            <a class="tabButton ${empty typeCode ? 'tabButtonActive' : ''}" href="?typeCode=">
                <i class="fas fa-list"></i> 전체 신청
            </a>
            <a class="tabButton ${typeCode == 'AC_MAJOR' ? 'tabButtonActive' : ''}" href="?typeCode=AC_MAJOR">
                <i class="fas fa-book"></i> 전공 변경
            </a>
            <a class="tabButton ${typeCode == 'AC_DOUBLE' ? 'tabButtonActive' : ''}" href="?typeCode=AC_DOUBLE">
                <i class="fas fa-bookmark"></i> 복수 전공
            </a>
            <a class="tabButton ${typeCode == 'AC_SUSPEND' ? 'tabButtonActive' : ''}" href="?typeCode=AC_SUSPEND">
                <i class="fas fa-exchange-alt"></i> 휴학
            </a>
            <a class="tabButton ${typeCode == 'AC_RETURN' ? 'tabButtonActive' : ''}" href="?typeCode=AC_RETURN">
                <i class="fas fa-user-minus"></i> 복학
            </a>
            <a class="tabButton ${typeCode == 'AC_GRADSUS' ? 'tabButtonActive' : ''}" href="?typeCode=AC_GRADSUS">
                <i class="fas fa-door-open"></i> 졸업 유예
            </a>
        </div>

        <!-- 검색 및 필터 -->
        <div class="card">
            <h2>
                <i class="fas fa-search"></i>
                검색 및 필터
            </h2>
            <form method="get" action="/staff/requestCollection/requestCollection.do" style="margin-bottom: 1rem;">
                <!-- 현재 선택된 typeCode를 hidden으로 전달 -->
                <input type="hidden" name="typeCode" value="${typeCode}"/>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="inputLabel">처리 상태</label>
                        <select class="selectBox" id="statusFilter" name="status">
                            <option value="" ${empty status ? 'selected' : ''}>전체</option>
                            <option value="대기중" ${status == '대기중' ? 'selected' : ''}>대기 중</option>
                            <option value="승인" ${status == '승인' ? 'selected' : ''}>승인</option>
                            <option value="반려" ${status == '반려' ? 'selected' : ''}>반려</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="inputLabel">검색 항목</label>
                        <select class="selectBox" name="searchType">
                            <option value="all" ${searchType == 'all' ? 'selected' : ''}>전체</option>
                            <option value="requestNo" ${searchType == 'requestNo' ? 'selected' : ''}>신청번호</option>
                            <option value="userNo" ${searchType == 'userNo' ? 'selected' : ''}>학번</option>
                            <option value="userName" ${searchType == 'userName' ? 'selected' : ''}>이름</option>
                            <option value="departmentName" ${searchType == 'departmentName' ? 'selected' : ''}>학과</option>
                            <option value="collegeName" ${searchType == 'collegeName' ? 'selected' : ''}>단과대학</option>
                            <option value="typeName" ${searchType == 'typeName' ? 'selected' : ''}>신청유형</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="inputLabel">검색어</label>
                        <input type="text" class="inputField" name="keyword" id="searchInput" placeholder="학번 또는 이름을 입력하세요" value="${keyword}">
                    </div>
                    <div class="form-group" style="flex: 0;">
                        <button class="searchButton" type="submit" class="submitButton">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- 신청 목록 -->
        <div class="card">
            <div class="sectionHeaderLine">
                <div>
                    <h2 class="sectionHeaderTitle">학적 변경 신청 목록</h2>
                    <p class="sectionHeaderDescription">학생들의 학적 변경 신청을 관리하고 처리할 수 있습니다.</p>
                </div>
            </div>

            <div class="tableContainer">
                <table class="defaultTable" id="applicationsTable">
                    <thead class="tableHead">
                        <tr>
                            <th class="tableTh">
                                <input type="checkbox" class="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th class="tableTh">신청번호</th>
                            <th class="tableTh">신청일</th>
                            <th class="tableTh">학번</th>
                            <th class="tableTh">이름</th>
                            <th class="tableTh">학과</th>
                            <th class="tableTh">단과대학</th>
                            <th class="tableTh">신청 유형</th>
                            <th class="tableTh">신청 내용</th>
                            <th class="tableTh">처리 상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        <c:forEach var="request" items="${requestList}" varStatus="status">
                            <tr>
                                <td class="tableTd">${status.index + 1}</td>
                                <td class="tableTd">${request.requestNo}</td>
                                <td class="tableTd">${request.requestDate}</td>
                                <td class="tableTd">${request.userNo}</td>
                                <td class="tableTd">${request.user.userName}</td>
                                <td class="tableTd">${request.department.departmentName}</td>
                                <td class="tableTd">${request.college.collegeName}</td>
                                <td class="tableTd">${request.type.typeName}</td>
                                <td class="tableTd">${request.reason}</td>
                                <td class="tableTd">
                                    <c:choose>
                                        <c:when test="${request.status == '대기중'}">
                                            <span class="status-waiting badge badgeYellow">대기중</span>
                                        </c:when>
                                        <c:when test="${request.status == '반려'}">
                                            <span class="status-processing badge badgeRed">반려</span>
                                        </c:when>
                                        <c:when test="${request.status == '완료'}">
                                            <span class="status-complete badge badgeGreen">완료</span>
                                        </c:when>
                                        <c:otherwise>
                                            ${request.status}
                                        </c:otherwise>
                                    </c:choose>
                                </td>
                            </tr>
                        </c:forEach>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>