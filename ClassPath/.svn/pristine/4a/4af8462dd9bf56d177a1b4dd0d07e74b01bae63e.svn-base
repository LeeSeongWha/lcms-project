package kr.or.ddit.pfcp.staff.schedule.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.pfcp.common.vo.ScheduleVO;
import kr.or.ddit.pfcp.staff.schedule.service.StaffScheduleService;

/**
 * @author YSM
 * @since 250628
 */
@Controller
@RequestMapping("/staff/schedule")
public class StaffScheduleController {

	/**
	 * 1. 일정 관리 진입 폼
	 * @return url
	 */
	
	@Autowired
	private StaffScheduleService scheduleService;
	
	
    @GetMapping
    public String scheduleMain() {
        return "pfcp/staff/schedule/scheduleMain";
    }
    /**
     * 2. 풀캘린더 불러옴
     * @param type
     * @return
     */
    
    @GetMapping("/list")
    @ResponseBody
    public List<Map<String, Object>> getScheduleList() {
        List<ScheduleVO> scheduleList = scheduleService.readScheduleList();

        return scheduleList.stream().map(s -> {
            Map<String, Object> map = new HashMap<>();
            map.put("title", s.getScheduleTitle());
            map.put("start", s.getStartDate().toString());
            map.put("end", s.getEndDate().toString());
            map.put("refType", s.getRef() != null ? s.getRef().getRefType() : null);
            return map;
        }).collect(Collectors.toList());
    }
	
	
}
