<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.pfcp.student.certificate.mapper.StudentCertificateMapper">
	<resultMap type="ProgramVO" id="programMap" autoMapping="true">
		<id property="programNo" column="PROGRAM_NO"/>
		
		<association property="programEnroll" javaType="ProgramEnrollVO">
			<id property="enrollNo" column="ENROLL_NO"/>
			<result property="programNo" column="PROGRAM_NO"/>
		</association>
	</resultMap>
	
	<select id="selectCertificateInfo" parameterType="map">
		SELECT CERT_CODE
	           , CERT_NAME
	           , CERT_DESC
	           , IS_ACTIVE
	           , ISSUE_FEE
	           , FILE_REF_NO
	      FROM CERTIFICATE_INFO
	     WHERE CERT_CODE=#{certCode}
	</select>
	
	<select id="selectIsCompleted">
		SELECT A.ENROLL_NO
	           , A.PROGRAM_NO
	           , A.USER_NO
	           , A.APPLY_DATE
	           , A.IS_ATTENDED
	           , A.IS_COMPLETED
	           , A.PROGRAM_SCORE
	           , A.VOLUNTEER_HOUR
	           , A.IS_CERT_ISSUED
	           , A.FILE_REF_NO
               , B.CERT_REQNO
	      FROM PROGRAM_ENROLL A
    INNER JOIN PROGRAM_CERT_REQ B ON A.ENROLL_NO=B.ENROLL_NO
	     WHERE A.USER_NO=#{userNo}
	       AND A.PROGRAM_NO=#{programNo}
	</select>

	<select id="selectCertificateList">
		SELECT CERT_CODE
	           , CERT_NAME
	           , CERT_DESC
	           , IS_ACTIVE
	           , ISSUE_FEE
	           , FILE_REF_NO
	      FROM CERTIFICATE_INFO
	</select>

	<select id="selectStudentName">
		SELECT B.USER_NAME
	      FROM STUDENT A
	INNER JOIN TB_USER B ON A.USER_NO=B.USER_NO
	     WHERE B.USER_NO=#{userNo}
	</select>
	
	<select id="selectProgramList">
		SELECT A.PROGRAM_NO
	           , A.TYPE_CODE
	           , A.PROGRAM_TITLE
	           , A.PROGRAM_DESP
	           , A.PROGRAM_CAPACITY
	           , A.START_DATE
	           , A.END_DATE
	           , A.PLACE
	           , A.PROGRAM_ACTIVE
	           , A.USER_NO
	           , A.APPLY_START_DATE
	           , A.APPLY_END_DATE
	      FROM PROGRAM A
	INNER JOIN PROGRAM_ENROLL B ON A.PROGRAM_NO=B.PROGRAM_NO
	     WHERE B.USER_NO=#{userNo}
	</select>

	<select id="selectProgramTitle" parameterType="map">
		SELECT A.PROGRAM_TITLE
		       , B.ENROLL_NO
	      FROM PROGRAM A
	INNER JOIN PROGRAM_ENROLL B ON A.PROGRAM_NO=B.PROGRAM_NO
	     WHERE A.PROGRAM_NO=#{programNo}
	       AND B.USER_NO=#{userNo}
	</select>
	
	<insert id="insertProgramCertReq">
		INSERT INTO PROGRAM_CERT_REQ (
			CERT_REQNO
			, ENROLL_NO
			, USER_NO
			, CERREQ_DATE
			, CERREQ_STATUS
			, CERREQ_COMMENT
		) VALUES (
			'CERT' || LPAD(SEQ_CERT_REQ.NEXTVAL, 3, '0')
			, #{enrollNo}
			, #{userNo}
			, TO_CHAR(SYSDATE, 'YYYY-MM-DD')
			, '대기중'
			, #{cerreqComment}
		)
	</insert>
	
	<select id="selectProgramCertIssuedCertificates">
		SELECT A.CERT_ISSUENO
	           , A.CERT_REQNO
	           , A.ISSUE_DATE
	           , A.FILE_REF_NO
	           , A.USER_NO
	           , D.USER_NAME
	      FROM PROGRAM_CERT_ISSUE A
	INNER JOIN PROGRAM_CERT_REQ B ON A.CERT_REQNO=B.CERT_REQNO
	INNER JOIN PROGRAM_ENROLL C ON B.ENROLL_NO=C.ENROLL_NO
	INNER JOIN TB_USER D ON A.USER_NO=D.USER_NO
	     WHERE C.USER_NO=#{userNo}
	</select>
</mapper>