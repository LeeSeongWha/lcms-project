<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c"%>

<title>ì‹œì„¤ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ì„¤ì •</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="/dist/assets/css/bodyFormat.css"> 


	<!-- ======================================== -->
	<div class="sectionHeaderLine">
	  <!-- ì™¼ìª½ ì œëª© ë° ì„¤ëª… -->
	  <div>
	    <div class="sectionHeaderTitle">êµìˆ˜ ëª©ë¡</div>
	    <div class="sectionHeaderDescription">ì „ì²´ ${count}ëª…ì˜ êµìˆ˜</div>
	  </div>
	
	  <!-- ì˜¤ë¥¸ìª½ ë“±ë¡ ë²„íŠ¼ -->
	  <button type="button" class="submitButton">+ ë“±ë¡</button>
	</div>
	<!-- ======================================== -->
	<c:if test="${mode == 'edit'}">
		<div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
			<p class="text-yellow-800 font-medium text-center">ğŸ“ ìˆ˜ì • ëª¨ë“œ:
				ì‹œê°„í‘œì˜ ì…€ì„ í´ë¦­í•˜ì—¬ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
		</div>
	</c:if>



		<div class="layout-wrapper" style="display: flex; gap: 2rem; align-items: flex-start;">

	<!-- ì™¼ìª½: êµìˆ˜ ëª©ë¡ -->
	<div style="flex: 0 0 40%;">
		<div class="department-dropdown" style="margin-bottom: 1.5rem;">
			<select class="selectBox" onchange="filterProfessors(this.value)">
				<option value="">í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
				<option value="DP001">ì»´í“¨í„°ê³µí•™ê³¼</option>
				<option value="DP002">ì „ìê³µí•™ê³¼</option>
				<option value="DP003">ì‹œê°ë””ìì¸í•™ê³¼</option>
				<option value="DP004">ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼</option>
				<option value="DP005">êµ­ì–´êµ­ë¬¸í•™ê³¼</option>
			</select>
		</div>
		
		<div class="professor-card-wrapper" style="display: flex; flex-wrap: wrap; gap: 1rem;">
			<c:choose>
				<c:when test="${not empty professor }">
					<c:forEach items="${professor }" var="professor">
						<div class="card professor-card"
							 data-department="${professor.departmentNo}"
							 data-prof-id="${professor.userNo}"
							 onclick="selectProfessor('${professor.userNo}')"
							 style="flex: 1 1 100%; cursor: pointer; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s ease;">
							
							<div class="professor-card-icon"
								 style="font-size: 2rem; background-color: #f1f5f9; border-radius: 9999px; padding: 0.75rem; color: #3b82f6;">
								ğŸ‘¨â€ğŸ«
							</div>
							
							<div class="professor-info">
								<h4 style="margin: 0; font-size: 1rem; font-weight: 600; color: #1e293b;">${professor.user.userName}</h4>
								<p style="margin: 0.25rem 0 0; font-size: 0.875rem; color: #64748b;">${professor.department.departmentName}</p>
							</div>
						</div>
					</c:forEach>
				</c:when>
				<c:otherwise>
					<div class="noticeBox noticeWarning" style="width: 100%;">
						ì•„ì§ êµìˆ˜ ì—†ìŒ.
					</div>
				</c:otherwise>
			</c:choose>
		</div>
	</div>

	<!-- ì˜¤ë¥¸ìª½: êµìˆ˜ ìƒì„¸ ì •ë³´ (ì˜ˆ: ìƒë‹´ ì¼ì • í…Œì´ë¸”) -->
	<div class="professor-detail" style="flex: 1;">
		<div class="tableContainer">
			<table class="defaultTable">
				<thead class="tableHead">
					<tr>
						<th class="tableTh">ë‚ ì§œ</th>
						<th class="tableTh">ìš”ì¼</th>
						<th class="tableTh">ìƒë‹´ì‹œì‘</th>
						<th class="tableTh">ìƒë‹´ì¢…ë£Œ</th>
						<th class="tableTh">ì†Œì†</th>
						<th class="tableTh">ì´ë¦„</th>
						<th class="tableTh">ìƒë‹´ë°©ë²•</th>
						<th class="tableTh">ì •ì›</th>
						<th class="tableTh">ì”ì—¬ì„</th>
					</tr>
				</thead>
				<tbody id="scheduleTableBody">
					<tr class="tableRowHover time-slot available" onclick="bookCounseling(this)">
						<td class="tableTd">2025-06-27</td>
						<td class="tableTd">ê¸ˆìš”ì¼</td>
						<td class="tableTd">07:00</td>
						<td class="tableTd">18:00</td>
						<td class="tableTd">ìŠ¤ë§ˆíŠ¸ìœµí•©ëŒ€í•™/ì»´í“¨í„°ê³µí•™ê³¼/ì»´í“¨í„°ê³µí•™ê³¼</td>
						<td class="tableTd prof-name-in-table">ì†¡ì§€ì˜</td>
						<td class="tableTd">ì˜¨ë¼ì¸ìƒë‹´</td>
						<td class="tableTd">30</td>
						<td class="tableTd">30</td>
					</tr>
					<!-- êµìˆ˜ ì„ íƒ ì‹œ AJAXë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥ -->
				</tbody>
			</table>
		</div>
	</div>

</div>

<script>
  // êµìˆ˜ ì •ë³´ ë°ì´í„° (ê°€ì •ëœ ë°ì´í„° - ì‹¤ì œë¡œëŠ” DBì—ì„œ ê°€ì ¸ì˜´)
//   const professors = {
//     prof1: { name: 'ì†¡ì§€ì˜', dept: 'ìŠ¤ë§ˆíŠ¸ìœµí•©ëŒ€í•™/ì»´í“¨í„°ê³µí•™ê³¼', major: 'ì „ê³µ: ì¸ê³µì§€ëŠ¥, ë¨¸ì‹ ëŸ¬ë‹' }
//   };

  let selectedProfessorId = null; // Currently selected professor ID

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
  window.onload = function() {
    document.querySelector('.no-professors').classList.add('show');
    // Hide modify button on initial load
    document.getElementById('modifyCounselingTimeBtn').style.display = 'none';
  };

  function filterProfessors(department) {
    const professorCards = document.querySelectorAll('.professor-card');
    const noProfessorsMsg = document.querySelector('.no-professors');
    const modifyBtn = document.getElementById('modifyCounselingTimeBtn');
    
    // ëª¨ë“  êµìˆ˜ ì¹´ë“œ ìˆ¨ê¸°ê¸°
    professorCards.forEach(card => {
      card.classList.remove('show', 'selected');
    });
    
    // Reset selected professor and hide modify button
    selectedProfessorId = null;
    modifyBtn.style.display = 'none';

    if (department === '') {
      // í•™ê³¼ë¥¼ ì„ íƒí•˜ì§€ ì•Šì€ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
      noProfessorsMsg.classList.add('show');
      document.getElementById('scheduleView').style.display = 'none';
    } else {
      // ì„ íƒëœ í•™ê³¼ì˜ êµìˆ˜ë§Œ í‘œì‹œ
      noProfessorsMsg.classList.remove('show');
      const filteredCards = document.querySelectorAll(`[data-department=${departmentNo}`);
      filteredCards.forEach(card => {
        card.classList.add('show');
      });
      
      // ìŠ¤ì¼€ì¤„ ë·° ìˆ¨ê¸°ê¸° (ìƒˆë¡œìš´ í•™ê³¼ ì„ íƒ ì‹œ)
      document.getElementById('scheduleView').style.display = 'none';
    }
  }

  function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-menu button').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.currentTarget.classList.add('active');

    // If switching to counseling tab, and no professor is selected, hide the modify button
    if (id === 'counseling') {
        const modifyBtn = document.getElementById('modifyCounselingTimeBtn');
        if (!selectedProfessorId) {
            modifyBtn.style.display = 'none';
        } else {
            modifyBtn.style.display = 'block'; // Show if a professor is already selected
        }
    }
  }

  function searchStudent() {
    const q = document.getElementById("search").value.toLowerCase();
    document.querySelectorAll("#studentTable tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(q) ? "" : "none";
    });
  }

  function selectProfessor(profId) {
    // Set the currently selected professor ID
    selectedProfessorId = profId;

    // Show the modify counseling time button
    const modifyBtn = document.getElementById('modifyCounselingTimeBtn');
    modifyBtn.style.display = 'block';
    // Update the button's href to include the selected professor's ID
    modifyBtn.onclick = function() {
        location.href = `í•™ìƒê´€ë¦¬ìƒë‹´ì‹œê°„ì„¤ì •.html?profId=${selectedProfessorId}`;
    };


    // ëª¨ë“  êµìˆ˜ ì¹´ë“œì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
    document.querySelectorAll('.professor-card').forEach(card => {
      card.classList.remove('selected');
    });
    
    // í´ë¦­í•œ êµìˆ˜ ì¹´ë“œì— ì„ íƒ ìƒíƒœ ì¶”ê°€
    event.currentTarget.classList.add('selected');
    
    // êµìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
    const prof = professors[profId];
    document.getElementById('professorName').textContent = prof.name + ' êµìˆ˜ë‹˜ ìƒë‹´ ì‹œê°„í‘œ';
    document.getElementById('professorDept').textContent = prof.dept;
    
    // ì‹œê°„í‘œì˜ êµìˆ˜ ì´ë¦„ ì—…ë°ì´íŠ¸ (uses class for multiple elements)
    document.querySelectorAll('.prof-name-in-table').forEach(element => {
        element.textContent = prof.name;
    });
    
    // ìŠ¤ì¼€ì¤„ ë·° í‘œì‹œ
    document.getElementById('scheduleView').style.display = 'block';
  }

  function bookCounseling(row) {
    if (row.classList.contains('available')) {
      if (confirm('ì´ ì‹œê°„ëŒ€ë¡œ ìƒë‹´ì„ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        row.classList.remove('available');
        row.classList.add('booked');
        // ì”ì—¬ì„ ê°ì†Œ
        const remainingCell = row.cells[8];
        const remaining = parseInt(remainingCell.textContent) - 1;
        remainingCell.textContent = remaining;
        alert('ìƒë‹´ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    } else if (row.classList.contains('booked')) {
      alert('ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤.');
    }
  }

  function changePage(direction) {
    // í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ëŠ¥ (ì‹¤ì œë¡œëŠ” ì„œë²„ ì—°ë™ í•„ìš”)
    console.log('Page change:', direction);
  }
</script>
