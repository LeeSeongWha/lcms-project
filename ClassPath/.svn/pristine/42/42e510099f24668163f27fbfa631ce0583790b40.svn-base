<?xml version="1.0" encoding="UTF-8"?>
<!-- 
 * == 개정이력(Modification Information) ==
 * 수정일		수정자	수정내용
 * ========================================
 * 250704	김태수	최초 생성
 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.pfcp.professor.lecture.mapper.ProfessorLectureMapper">

	<resultMap id="ProfessorLectureMap" type="LectureReqVO">
		<id property="reqNo" column="REQ_NO"/> 
		
		<result property="subjectCode" column="SUBJECT_CODE"/>
		<result property="lecName" column="LEC_NAME"/>
		<result property="reqDate" column="REQ_DATE"/>
		<result property="status" column="STATUS"/>
		<result property="rejReason" column="REJ_REASON"/>
		
		<result property="rnum" column="RNUM"/> 
		
		<result property="userName" column="USER_NAME"/> 
		<result property="subjectName" column="SUBJECT_NAME"/>
	</resultMap>


	<select id="selectLectureList" resultMap="ProfessorLectureMap" parameterType="String">
		 SELECT
		 	ROW_NUMBER() OVER (ORDER BY P.USER_NO) AS RNUM,
            LR.REQ_NO,
            LR.SUBJECT_CODE,
            LR.LEC_NAME,
            U.USER_NAME,
            S.SUBJECT_NAME, 
            LR.REQ_DATE,          
            LR.STATUS,
            LR.REJ_REASON
            
            
        FROM
            LECTURE_REQ LR
        JOIN
            SUBJECT S ON LR.SUBJECT_CODE = S.SUBJECT_CODE
        JOIN
            PROFESSOR P ON LR.USER_NO = P.USER_NO    
        JOIN
            TB_USER U ON P.USER_NO = U.USER_NO         
        LEFT JOIN                                    
            FILE_REF F ON LR.FILE_REF_NO = F.FILE_REF_NO
        WHERE
            LR.USER_NO = #{userNo}              
        ORDER BY
            LR.REQ_DATE DESC, LR.REQ_NO ASC
	</select>

	<select id="selectLecture">
		SELECT
		 	ROW_NUMBER() OVER (ORDER BY P.USER_NO) AS RNUM,
            LR.REQ_NO,
            LR.SUBJECT_CODE,
            LR.LEC_NAME,
            U.USER_NAME,
            S.SUBJECT_NAME, 
            LR.REQ_DATE,          
            LR.STATUS,
            LR.REJ_REASON
            
            
        FROM
            LECTURE_REQ LR
        JOIN
            SUBJECT S ON LR.SUBJECT_CODE = S.SUBJECT_CODE
        JOIN
            PROFESSOR P ON LR.USER_NO = P.USER_NO    
        JOIN
            TB_USER U ON P.USER_NO = U.USER_NO         
        LEFT JOIN                                    
            FILE_REF F ON LR.FILE_REF_NO = F.FILE_REF_NO
        WHERE
            LR.USER_NO = #{userNo}              
        ORDER BY
            LR.REQ_DATE DESC, LR.REQ_NO ASC
	</select>

	<insert id="insertLecture" parameterType="LectureReqVO">
    INSERT INTO LECTURE_REQ (
        REQ_NO, SUBJECT_CODE, USER_NO, PRE_DAY, PRE_TIME, PRE_CLASSRM,
        STATUS, REJ_REASON, REQ_DATE, MAX_CAPACITY, FILE_REF_NO, LEC_NAME, LEC_CATEGORY
    ) VALUES (
        'REQ' || LPAD(SEQ_LECTURE_REQ.NEXTVAL, 3, '0'),  
        #{subjectCode},
        #{userNo},
        #{preDay},
        #{preTime},
        #{preClassrm},
        '대기',
        NULL,   
        TO_CHAR(SYSDATE, 'YYYY-MM-DD'),
        #{maxCapacity},
        #{fileRefNo},
        #{lecName},
        #{lecCategory}
    )
</insert>



 <select id="selectLectureCategories" resultType="string">
        SELECT DISTINCT LEC_CATEGORY
		FROM LECTURE_REQ 
    </select>

    <select id="selectSubjects" resultType="Map">
         SELECT
            SUBJECT_CODE,
            SUBJECT_NAME
        FROM SUBJECT
        WHERE LENGTH(TRIM(SUBJECT_CODE)) > 0 AND LENGTH(TRIM(SUBJECT_NAME)) > 0
        ORDER BY SUBJECT_NAME ASC
    </select>

    <select id="selectClassroomNames" resultType="string">
        SELECT DISTINCT LR_NAME
		FROM LECTURE_ROOM 
    </select>


	<update id="updateLecutre">

	</update>

	<delete id="deleteLecutre">

	</delete>

</mapper>