<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.pfcp.staff.lecturemanage.attendance.mapper.AttendanceMapper">

 <resultMap id="AttendanceResultMap" type="kr.or.ddit.pfcp.common.vo.AttendanceVO">
    <id property="lecNo" column="LEC_NO"/>
    <result property="rnum" column="RNUM"/>
    <result property="currentEnrollment" column="CURRENT_ENROLLMENT"/>
    <result property="lecStatus" column="LEC_STATUS"/>
    <result property="lrNo" column="LR_NO"/>
    <result property="userNo" column="LECTURE_PROF_NO"/>
    
    
    <association property="user" javaType="kr.or.ddit.pfcp.common.vo.UserVO">
    	<result property="userNo" column="USER_NO"/>
    	<result property="userName" column="LECTURE_PROF_NAME"/>
    	<result property="userName" column="USER_NAME"/>
    </association>
    
    <association property="lectureReq" javaType="kr.or.ddit.pfcp.common.vo.LectureReqVO">
    </association>
      
</resultMap>




	<select id="selectAttendanceList">
	SELECT
		ROW_NUMBER() OVER (ORDER BY A.ATTEND_ID) AS RNUM,
	    A.ATTEND_ID,
	    A.ENROLL_NO,
	    A.ATTEND_DATE,
	    A.ATTEND_STATUS,
	    A.MEMO,
	    TU.USER_NAME,
	    LR.LEC_NAME
	FROM
	    ATTENDANCE A
	JOIN
	    LECTURE_ENR LE ON A.ENROLL_NO = LE.ENROLL_NO
	JOIN
	    TB_USER TU ON LE.USER_NO = TU.USER_NO
	JOIN
	    STUDENT S ON TU.USER_NO = S.USER_NO -- TB_USER와 STUDENT 테이블 연결 (USER_NO를 키로 사용)
	JOIN
	    LECTURE L ON LE.LEC_NO = L.LEC_NO
	JOIN
	    LECTURE_REQ LR ON L.REQ_NO = LR.REQ_NO 
	WHERE
	    LE.ENROLL_NO = #{enrollNo} AND LE.USER_NO = #{userNo}     
	</select>


</mapper>