<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<%--
    파일명 : facilityList.jsp
    프로그렴명 : 시설 전체 조회 화면
    설 명 : 등록된 시설물 전체를 조회할 수 있음.
    작성자 : 양 수 민
    작성일 : 2025. 07. 01
--%>	


  <title>시설 관리</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">


  <div class="max-w-6xl mx-auto bg-white rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-blue-700">시설 관리</h2>
      <button onclick="showAddFacilityPage()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">+ 새 시설 등록</button>
    </div>

    <!-- 시설 검색 -->
    <div class="mb-6">
      <div class="flex space-x-2">
        <input type="text" id="facilitySearchInput" placeholder="시설명 또는 시설 유형으로 검색"
               class="flex-grow border border-gray-300 px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
        <button onclick="searchFacilities()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">검색</button>
      </div>
    </div>

    <!-- 시설 목록 -->
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border border-gray-200 rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left border">시설 코드</th>
            <th class="px-4 py-2 text-left border">시설명</th>
            <th class="px-4 py-2 text-left border">시설 유형</th>
            <th class="px-4 py-2 text-left border">위치</th>
          </tr>
        </thead>
        <tbody id="facilityTableBody" class="bg-white divide-y divide-gray-100">
          <!-- 시설 목록이 여기에 렌더링됨 -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function renderFacilityList(facilityList) {
      const tbody = document.getElementById('facilityTableBody');
      tbody.innerHTML = '';
      if (facilityList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">조회된 시설 정보가 없습니다.</td></tr>';
        return;
      }
      facilityList.forEach((facility) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="px-4 py-2 border">${facility.facilityNo}</td>
          <td class="px-4 py-2 border">${facility.facilityName}</td>
          <td class="px-4 py-2 border">${facility.facilityType}</td>
          <td class="px-4 py-2 border">${facility.location}</td>
          <td class="px-4 py-2 border text-center">
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                    onclick="showFacilityDetailPage('${facility.id}')">상세 보기</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function searchFacilities() {
      const searchTerm = document.getElementById('facilitySearchInput').value.toLowerCase();
      const filtered = facilities.filter(f =>
        f.name.toLowerCase().includes(searchTerm) ||
        f.type.toLowerCase().includes(searchTerm) ||
        f.location.toLowerCase().includes(searchTerm)
      );
      renderFacilityList(filtered);
    }

    function showAddFacilityPage() {
      const newId = 'FAC' + String(facilities.length + 1).padStart(3, '0');
      const newFacility = {
        id: newId, name: '새 시설명', type: '', location: '', capacity: 1, description: '',
        registerDate: new Date().toISOString().slice(0, 10)
      };
      facilities.push(newFacility);
      renderFacilityList(facilities);
      alert(`새로운 시설 (ID: ${newId})이 목록에 추가되었습니다. 상세 페이지에서 수정해 주세요.`);
      showFacilityDetailPage(newId);
    }

    function showFacilityDetailPage(id) {
      window.location.href = `facilityDetail.jsp?id=${id}`;
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderFacilityList(facilities);
    });
  </script>


