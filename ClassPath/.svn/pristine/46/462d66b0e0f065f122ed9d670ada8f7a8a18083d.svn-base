<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%--  
    파일명 : studentList.jsp  
    프로그램명 : 학생 전체 조회 화면  
    설명 : 학과별로 학생을 조회할 수 있음. (검색 가능)  
    작성자 : 양 수 민  
    작성일 : 2025. 07. 01  
--%>

<title>학생 관리 시스템</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<script>
  function toggleStudents(departmentNo) {
    const target = document.getElementById("students-" + departmentNo);
    target.classList.toggle("hidden");
  }
</script>

<div class="bg-white rounded-xl shadow p-6 mb-8">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-blue-800">학생 관리 시스템</h1>
      <p class="text-sm text-gray-500 mt-1">전체 학생 현황을 확인하고 관리하세요</p>
    </div>
    <div class="text-right text-blue-700 font-bold text-xl">
      <span>${totalStudentCount}</span> 총 학생 수
    </div>
  </div>
</div>

<c:forEach var="dept" items="${department}">
  <div class="bg-white rounded-xl shadow mb-4">
    <button class="w-full text-left p-4 flex justify-between items-center" onclick="toggleStudents('${dept.departmentNo}')">
      <div class="flex items-center space-x-3">
        <div class="bg-blue-100 text-blue-600 p-2 rounded-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <span class="text-lg font-medium">${dept.name}</span>
      </div>
      <span class="text-sm text-gray-600">${dept.studentCount}명</span>
    </button>

    <div id="students-${dept.departmentNo}" class="hidden border-t px-6 py-4">
      <c:forEach var="stu" items="${dept.students}">
      <c:url value="/staff/studentmanage/studentDetail.do" var="detailURL">
		<c:param name="what" value="${stu.userNo }"/>
	</c:url>
        <a href="${detailURL }"
          class="block bg-gray-50 p-4 rounded-lg mb-2 hover:bg-blue-100 transition">
          <div class="flex justify-between items-center">
            <div>
              <p class="font-bold text-gray-800">${stu.userName}</p>
              <p class="text-sm text-gray-500">
                학번: ${stu.userNo} ・ ${stu.studentGrade}학년
              </p>
            </div>
            <span class="bg-green-100 text-green-700 px-3 py-1 text-sm rounded-full">
              ${stu.status}
            </span>
          </div>
        </a>
      </c:forEach>
    </div>
  </div>
</c:forEach>
