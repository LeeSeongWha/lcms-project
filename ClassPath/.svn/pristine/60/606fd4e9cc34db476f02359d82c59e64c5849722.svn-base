<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.pfcp.student.eclass.exam.mapper.ExamMapper">
	<select id="selectExamList" parameterType="map">
		SELECT A.EXAM_NO
			   , A.LEC_NO
			   , A.EXAM_NAME
			   , A.EXAM_DATE
			   , A.EXAM_TYPE
			   , A.EXAM_LIMIT
			   , A.FACILITY_NO
			   , A.FILE_REF_NO
			   , A.STATUS
			   , B.USER_NO
	      FROM EXAM A
	INNER JOIN (
	        SELECT DISTINCT LEC_NO, USER_NO
	          FROM LECTURE_ENR
	         WHERE USER_NO = #{userNo}) B ON A.LEC_NO = B.LEC_NO
	     WHERE A.LEC_NO=#{lecNo}
	</select>
	
	<select id="selectExamDetail">
		SELECT A.EXAM_NO
	           , A.LEC_NO
	           , A.EXAM_NAME
	           , A.EXAM_DATE
	           , A.EXAM_TYPE
	           , A.EXAM_LIMIT
	           , A.FACILITY_NO
	           , A.FILE_REF_NO
	           , A.STATUS
	           , COUNT(B.QUESTION_SEQ) AS QUESTION_SEQ
	      FROM EXAM A
	INNER JOIN QUESTION_ANSWER B ON A.EXAM_NO=B.EXAM_NO      
	     WHERE A.EXAM_NO=#{examNo}
	     GROUP BY A.EXAM_NO
	              , A.LEC_NO
	              , A.EXAM_NAME
	              , A.EXAM_DATE
	              , A.EXAM_TYPE
	              , A.EXAM_LIMIT
	              , A.FACILITY_NO
	              , A.FILE_REF_NO
	              , A.STATUS
	</select>
</mapper>