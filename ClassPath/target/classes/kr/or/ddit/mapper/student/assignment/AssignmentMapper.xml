<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.or.ddit.pfcp.student.eclass.assignement.mapper.AssignmentMapper">
	
	<select id="selectAssignmentList">
	 SELECT
		A.ASSIGN_NO
		,A.LEC_NO
		,A.ASSIGN_TITLE
		,A.ASSIGN_DEADLINE
		,A.ASSIGN_DESP
		,A.FILE_REF_NO
	  FROM ASSIGNMENT A
      INNER JOIN LECTURE L ON A.LEC_NO=L.LEC_NO
      INNER JOIN LECTURE_REQ LR ON LR.REQ_NO=L.REQ_NO
      INNER JOIN SUBJECT S ON S.SUBJECT_CODE=LR.SUBJECT_CODE
      INNER JOIN SEMESTER SS ON SS.SEMESTER_NO=S.SEMESTER_NO
	 WHERE A.LEC_NO=#{lecNo}
       AND SS.SEMESTER_ACT='Y'
	</select>
	
	<select id="selectAssignmentListByUserNo">
		SELECT
		A.ASSIGN_NO
		,A.LEC_NO
		,A.ASSIGN_TITLE
		,A.ASSIGN_DEADLINE
		,A.ASSIGN_DESP
		,A.FILE_REF_NO
	  FROM ASSIGNMENT A
      INNER JOIN LECTURE_ENR LE ON LE.LEC_NO=A.LEC_NO
      INNER JOIN TB_USER U ON U.USER_NO=LE.USER_NO
      INNER JOIN LECTURE L ON A.LEC_NO=L.LEC_NO
      INNER JOIN LECTURE_REQ LR ON LR.REQ_NO=L.REQ_NO
      INNER JOIN SUBJECT S ON S.SUBJECT_CODE=LR.SUBJECT_CODE
      INNER JOIN SEMESTER SS ON SS.SEMESTER_NO=S.SEMESTER_NO
	 WHERE U.USER_NO=#{uesrNo}
       AND SS.SEMESTER_ACT='Y'
	</select>
	
	<insert id="insertAssignment">
		INSERT INTO ASSIGNMENT (
							ASSIGN_NO, 
							LEC_NO, 
							ASSIGN_TITLE, 
							ASSIGN_DEADLINE, 
							ASSIGN_DESP, 
							FILE_REF_NO)
						VALUES (
						    'ASG' || LPAD(assign_seq.NEXTVAL, 3, '0'),
						    #{lecNo},
						    #{assignTitle},
						    #{assignDeadline},
						    #{assignDesp},
						    #{fileRefNo}
						)
	</insert>
	
	<update id="updateAssignment">
		UPDATE ASSIGNMENT
		   SET ASSIGN_TITLE=#{assignTitle}, 
							ASSIGN_DEADLINE=#{assignDeadline}, 
							ASSIGN_DESP=#{assignDesp}
		 WHERE ASSIGN_NO=#{assignNo}
	</update>
	
</mapper>
